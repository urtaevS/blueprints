alias: Telegram To-do List â€” Push updates from HA
description: >
  ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»Ñ‘Ğ½Ğ½Ñ‹Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ¿Ğ¾ĞºÑƒĞ¿Ğ¾Ğº Ğ² Telegram, ĞµÑĞ»Ğ¸ To-do Ğ¸Ğ·Ğ¼ĞµĞ½Ñ‘Ğ½ Ğ² Home
  Assistant (ĞĞ• Ğ¸Ğ· Ğ±Ğ¾Ñ‚Ğ°).
triggers:
  - entity_id: todo.1_testy
    trigger: state
conditions:
  - condition: template
    value_template: |
      {{ trigger.to_state is not none
         and trigger.to_state.context.parent_id is none }}
actions:
  - action: todo.get_items
    target:
      entity_id: todo.1_testy
    data:
      status:
        - needs_action
    response_variable: todo_resp
  - variables:
      items: "{{ todo_resp['todo.1_testy']['items'] | default([]) }}"
      text: |
        {% if items | length == 0 %}
          ğŸ›’ Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¿Ğ¾ĞºÑƒĞ¿Ğ¾Ğº Ğ¿ÑƒÑÑ‚ ğŸ¤·â€â™‚ï¸
        {% else %}
          ğŸ›’ Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¿Ğ¾ĞºÑƒĞ¿Ğ¾Ğº Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»Ñ‘Ğ½:
        {% endif %}
      keyboard: >
        {% set r = namespace(v=[]) %} {% for i in items %}
          {% set r.v = r.v + [[['âœ… ' ~ i.summary, '/done_' ~ i.uid]]] %}
        {% endfor %} {% set r.v = r.v + [[['ğŸ“‚ Ğ’ÑĞµ','/show_all']]] %} {% set r.v
        = r.v + [[['ğŸ—‘ ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ','/clear_completed']]] %} {{ r.v }}
  - action: telegram_bot.send_message
    data:
      config_entry_id: YOUR ID
      chat_id: YOUR ID
      message: "{{ text }}"
      inline_keyboard: "{{ keyboard }}"
mode: single
